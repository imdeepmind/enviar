{"version":3,"sources":["../../app/controller/interactions.js"],"names":["follow","req","res","me","authData","username","target","params","findQuery1","followee","$ne","findQuery2","$eq","update1","$push","update2","followers","userModel","findOneAndUpdate","err","doc","logger","error","boom","badImplementation","messages","debug","status","json","notFound","unfollow","$pull","block","findQuery","blocked","update","unblock","unblocked"],"mappings":"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","file":"interactions.js","sourcesContent":["import xss from 'xss';\n\nimport userModel from '../models/users';\nimport logger from '../utils/logger';\nimport messages from '../messages';\n\nexport const follow = (req, res) => {\n    const me = xss(req.authData.username);\n    const target = xss(req.params.username);\n\n    const findQuery1 = {\n        username: me, followee: {$ne: target}\n    }\n\n    const findQuery2 = {\n        username: {$eq: target}\n    }\n\n    const update1 = {\n        $push: {followee: target}\n    }\n\n    const update2 = {\n        $push: {followers: me}\n    }\n\n    userModel.findOneAndUpdate(findQuery1, update1, (err, doc) => {\n        if (err) {\n            logger.error('Database error: ', err);\n            return res.boom.badImplementation(messages['m500.0']);\n        } else if (doc){\n            userModel.findOneAndUpdate(findQuery2, update2, (err, doc) => {\n                if (err) {\n                    logger.error('Database error: ', err);\n                    return res.boom.badImplementation(messages['m500.0']);\n                } else if (doc) {\n                    logger.debug( `User with ${target} now following ${me} `);\n                    return res.status(201).json({\n                        followee: me,\n                        followers: target\n                    })\n                } else {\n                    logger.debug(`User does not exist`);\n                    return res.boom.notFound(messages['m404.0']);\n                }\n            })\n        } else {\n            logger.debug(`User does not exist`);\n            return res.boom.notFound(messages['m404.0']);\n        }\n    })\n}\n\nexport const unfollow = (req, res) => {\n    const me = xss(req.authData.username);\n    const target = xss(req.params.username);\n\n    const findQuery1 = {\n        username: me, followee: {$eq: target}\n    }\n\n    const findQuery2 = {\n        username: {$eq: target}\n    }\n\n    const update1 = {\n        $pull: {followee: target}\n    }\n\n    const update2 = {\n        $pull: {followers: me}\n    }\n\n    userModel.findOneAndUpdate(findQuery1, update1, (err, doc) => {\n        if (err) {\n            logger.error('Database error: ', err);\n            return res.boom.badImplementation(messages['m500.0']);\n        } else if (doc){\n            userModel.findOneAndUpdate(findQuery2, update2, (err, doc) => {\n                if (err) {\n                    logger.error('Database error: ', err);\n                    return res.boom.badImplementation(messages['m500.0']);\n                } else if (doc) {\n                    logger.debug( `User with ${target} not following ${me} `);\n                    return res.status(201).json({\n                        followee: me,\n                        followers: target\n                    })\n                } else {\n                    logger.debug(`User does not exist`);\n                    return res.boom.notFound(messages['m404.0']);\n                }\n            })\n        } else {\n            logger.debug(`User does not exist`);\n            return res.boom.notFound(messages['m404.0']);\n        }\n    })\n}\n\nexport const block = (req, res) => {\n    const me = xss(req.authData.username);\n    const target = xss(req.params.username);\n\n    const findQuery = {\n        username: me, blocked: {$ne: target}\n    }\n\n    const update = {\n        $push: {blocked: target}\n    }\n\n    userModel.findOneAndUpdate(findQuery, update, (err, doc) => {\n        if (err) {\n            logger.error('Database error: ', err);\n            return res.boom.badImplementation(messages['m500.0']);\n        } else if (doc){\n            logger.debug( `User with ${target} username blocked by ${me} username `);\n            return res.status(201).json({\n                blocked: target\n            })\n        } else {\n            logger.debug(`User does not exist`);\n            return res.boom.notFound(messages['m404.0']);\n        }\n    })\n}\n\nexport const unblock = (req, res) => {\n    const me = xss(req.authData.username);\n    const target = xss(req.params.username);\n\n    const findQuery = {\n        username: me, blocked: {$eq: target}\n    }\n\n    const update = {\n        $pull: {blocked: target}\n    }\n\n    userModel.findOneAndUpdate(findQuery, update, (err, doc) => {\n        if (err) {\n            logger.error('Database error: ', err);\n            return res.boom.badImplementation(messages['m500.0']);\n        } else if (doc){\n            logger.debug( `User with ${target} username unblocked by ${me} username `);\n            return res.status(201).json({\n                unblocked: target\n            })\n        } else {\n            logger.debug(`User does not exist`);\n            return res.boom.notFound(messages['m404.0']);\n        }\n    })\n}"]}